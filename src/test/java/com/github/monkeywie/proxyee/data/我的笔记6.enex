<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE en-export SYSTEM "http://xml.evernote.com/pub/evernote-export3.dtd">
<en-export export-date="20200422T161836Z" application="Evernote" version="Evernote Mac 9.2.3 (458956)">
<note><title>给websocket加入心跳包防止自动断开连接 - 程序园</title><content><![CDATA[<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd"><en-note>
  <div style="--en-clipped-content:article">
<div><br/></div><div style="font-size: 16px; display:block; min-width: 100%; position: relative;"> <div style="text-size-adjust:100%;font-size:14px;background-color:rgb(244, 246, 248);"><div style="font-family:&quot;Helvetica Neue&quot;, Helvetica, Tahoma, Arial, STXihei, &quot;Microsoft YaHei&quot;, 寰蒋闆呴粦, sans-serif;font-size:1em;line-height:1.5em;color:rgb(51, 51, 51);background-color:rgb(244, 246, 248);box-shadow:none;"><div><div><div style="background:rgb(255, 255, 255);box-shadow:rgba(0, 0, 0, 0.1) 0px 4px 10px;box-sizing:border-box;background-color:rgb(254, 254, 254);">

	<h1 style="font-family:inherit;color:inherit;text-rendering:optimizelegibility;margin:0px 0px 0.5em;font-weight:400;line-height:1.5em;margin-bottom:5px;font-size:24px;">给websocket加入心跳包防止自动断开连接</h1>
	
    <div style="padding-bottom:8px;border-bottom:1px dashed rgb(211, 211, 211);color:rgb(153, 153, 153);font-size:14px;">
        <div style="margin-bottom:2px;">
    		<span style="margin-right:5px;">时间  2017-09-05</span>
        </div>

			<div style="margin-bottom:2px;">
		            <span style="margin-right:5px;">标签</span>
						<a target="_blank" href="http://www.voidcn.com/tag/websocket" title="websocket" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;margin-right:5px;">websocket</span></a>
	        </div>
        
	        <div>
	        	<span style="margin-right:5px;">
	            	<i style="font-style:normal;float:left;">原文</i>  
	            	<a href="#" target="_blank" rel="nofollow" style="text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-break:keep-all;max-width:69%;display:inline;color:rgb(153, 153, 153);">http://blog.csdn.net/jkxqj/article/details/77848466</a>
	    		</span>
	        </div>
    </div>
    <div style="overflow-x:hidden;margin-bottom:0px;padding:10px 5px 25px;min-height:340px;overflow-wrap:break-word;word-break:break-all;font-size:16px;line-height:1.7em;">
	    	<div style="font-size:16px;line-height:1.7em;">

<ins style="display:block;height:280px;"><ins style="display:inline-table;border:none;height:280px;margin:0;padding:0;position:relative;visibility:visible;width:854px;background-color:transparent;"><ins style="display:block;border:none;height:280px;margin:0;padding:0;position:relative;visibility:visible;width:854px;background-color:transparent;"><div style="width:854px;height:280px;display:block;margin:0px auto 10px;left:0px;position:absolute;top:0px;border:0px;overflow:visible;"><div style="-evernote-clipper-iframe:timeout;"></div></div></ins></ins></ins>
</div>
        <div style="font-size:16px;line-height:1.7em;">
           <div style="font-size:16px;line-height:1.7em;"> 
 <pre style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;margin:0px 0px 0.75em;line-height:1.5em;word-break:break-all;overflow-wrap:break-word;white-space:pre-wrap;border:1px solid rgba(0, 0, 0, 0.15);border-radius:4px;margin-bottom:1.5em;overflow-x:auto;background:rgb(248, 248, 255);text-size-adjust:none;padding:0.5em;color:rgb(0, 0, 0);display:block;font-size:13px;"><span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">var</span></span> userId=$(<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">"#userId"</span></span>).val();
<span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">var</span></span> lockReconnect = <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">false</span></span>;  <span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">//避免ws重复连接</span></span>
<span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">var</span></span> ws = <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">null</span></span>;          <span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">// 判断当前浏览器是否支持WebSocket</span></span>
<span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">var</span></span> wsUrl = serverConfig.cyberhouse_ws+userId;
createWebSocket(wsUrl);   <span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">//连接ws</span></span>

<span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span> </span><span style="color:rgb(149, 65, 33);font-weight:normal;"><span><span style="color:rgb(149, 65, 33);font-weight:normal;">createWebSocket</span></span></span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">(url)</span></span></span><span> </span>{</span>
    <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">try</span></span>{
        <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">if</span></span>(<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">'WebSocket'</span></span> <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">in</span></span> <span style="color:rgb(0, 134, 179);">window</span>){
            ws = <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">new</span></span> WebSocket(url);
        }<span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">else</span></span> <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">if</span></span>(<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">'MozWebSocket'</span></span> <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">in</span></span> <span style="color:rgb(0, 134, 179);">window</span>){  
            ws = <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">new</span></span> MozWebSocket(url);
        }<span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">else</span></span>{
            layui.use([<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">'layer'</span></span>],<span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">()</span></span></span>{</span>
              <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">var</span></span> layer = layui.layer;
              layer.alert(<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">"您的浏览器不支持websocket协议,建议使用新版谷歌、火狐等浏览器，请勿使用IE10以下浏览器，360浏览器请使用极速模式，不要使用兼容模式！"</span></span>); 
            });
        }
        initEventHandle();
    }<span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">catch</span></span>(e){
        reconnect(url);
        <span style="color:rgb(0, 134, 179);">console</span>.log(e);
    }     
}

<span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span> </span><span style="color:rgb(149, 65, 33);font-weight:normal;"><span><span style="color:rgb(149, 65, 33);font-weight:normal;">initEventHandle</span></span></span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">()</span></span></span><span> </span>{</span>
    ws.onclose = <span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span> </span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">()</span></span></span><span> </span>{</span>
        reconnect(wsUrl);
        <span style="color:rgb(0, 134, 179);">console</span>.log(<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">"llws连接关闭!"</span></span>+<span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">new</span></span> <span style="color:rgb(0, 134, 179);"><span style="color:rgb(0, 134, 179);">Date</span></span>().toUTCString());
    };
    ws.onerror = <span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span> </span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">()</span></span></span><span> </span>{</span>
        reconnect(wsUrl);
        <span style="color:rgb(0, 134, 179);">console</span>.log(<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">"llws连接错误!"</span></span>);
    };
    ws.onopen = <span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span> </span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">()</span></span></span><span> </span>{</span>
        heartCheck.reset().start();      <span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">//心跳检测重置</span></span>
        <span style="color:rgb(0, 134, 179);">console</span>.log(<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">"llws连接成功!"</span></span>+<span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">new</span></span> <span style="color:rgb(0, 134, 179);"><span style="color:rgb(0, 134, 179);">Date</span></span>().toUTCString());
    };
    ws.onmessage = <span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span> </span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">(event)</span></span></span><span> </span>{</span>    <span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">//如果获取到消息，心跳检测重置</span></span>
        heartCheck.reset().start();      <span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">//拿到任何消息都说明当前连接是正常的</span></span>
        <span style="color:rgb(0, 134, 179);">console</span>.log(<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">"llws收到消息啦:"</span></span> +event.data);
        <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">if</span></span>(event.data!=<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">'pong'</span></span>){
            <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">var</span></span> obj=<span style="color:rgb(0, 134, 179);"><span style="color:rgb(0, 134, 179);">eval</span></span>(<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">"("</span></span>+event.data+<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">")"</span></span>);
            layui.use([<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">'layim'</span></span>], <span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">(layim)</span></span></span>{</span>
                <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">if</span></span>(obj.type==<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">"onlineStatus"</span></span>){
                    layim.setFriendStatus(obj.id, obj.content);
                }<span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">else</span></span> <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">if</span></span>(obj.type==<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">"friend"</span></span> || obj.type==<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">"group"</span></span>){
                    layim.getMessage(obj);  
                } 
    };
}
<span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">// 监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。</span></span>
<span style="color:rgb(0, 134, 179);">window</span>.onbeforeunload = <span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">()</span></span></span><span> </span>{</span>
    ws.close();
}  

<span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span> </span><span style="color:rgb(149, 65, 33);font-weight:normal;"><span><span style="color:rgb(149, 65, 33);font-weight:normal;">reconnect</span></span></span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">(url)</span></span></span><span> </span>{</span>
    <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">if</span></span>(lockReconnect) <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">return</span></span>;
    lockReconnect = <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">true</span></span>;
    setTimeout(<span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span> </span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">()</span></span></span><span> </span>{</span>     <span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">//没连接上会一直重连，设置延迟避免请求过多</span></span>
        createWebSocket(url);
        lockReconnect = <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">false</span></span>;
    }, <span style="color:rgb(64, 160, 112);"><span style="color:rgb(64, 160, 112);">2000</span></span>);
}

<span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">//心跳检测</span></span>
<span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">var</span></span> heartCheck = {
    timeout: <span style="color:rgb(64, 160, 112);"><span style="color:rgb(64, 160, 112);">540000</span></span>,        <span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">//9分钟发一次心跳</span></span>
    timeoutObj: <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">null</span></span>,
    serverTimeoutObj: <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">null</span></span>,
    reset: <span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">()</span></span></span>{</span>
        clearTimeout(<span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">this</span></span>.timeoutObj);
        clearTimeout(<span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">this</span></span>.serverTimeoutObj);
        <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">return</span></span> <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">this</span></span>;
    },
    start: <span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">()</span></span></span>{</span>
        <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">var</span></span> self = <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">this</span></span>;
        <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">this</span></span>.timeoutObj = setTimeout(<span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">()</span></span></span>{</span>
            <span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">//这里发送一个心跳，后端收到后，返回一个心跳消息，</span></span>
            <span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">//onmessage拿到返回的心跳就说明连接正常</span></span>
            ws.send(<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">"ping"</span></span>);
            <span style="color:rgb(0, 134, 179);">console</span>.log(<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">"ping!"</span></span>)
            self.serverTimeoutObj = setTimeout(<span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">function</span></span></span><span style="color:rgb(0, 0, 255);"><span><span style="color:rgb(0, 0, 255);">()</span></span></span>{</span><span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">//如果超过一定时间还没重置，说明后端主动断开了</span></span>
                ws.close();     <span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">//如果onclose会执行reconnect，我们执行ws.close()就行了.如果直接执行reconnect 会触发onclose导致重连两次</span></span>
            }, self.timeout)
        }, <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">this</span></span>.timeout)
    }
}</pre> 
 <pre style="font-family:Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;margin:0px 0px 0.75em;line-height:1.5em;word-break:break-all;overflow-wrap:break-word;white-space:pre-wrap;border:1px solid rgba(0, 0, 0, 0.15);border-radius:4px;margin-bottom:1.5em;overflow-x:auto;background:rgb(248, 248, 255);text-size-adjust:none;padding:0.5em;color:rgb(0, 0, 0);display:block;font-size:13px;"><span style="color:rgb(64, 128, 128);font-style:italic;"><span style="color:rgb(64, 128, 128);font-style:italic;">// 收到客户端消息后调用的方法 </span></span>
    <span><span>@OnMessage</span></span>  
    <span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">public</span></span></span><span> </span><span style="color:rgb(149, 65, 33);"><span><span style="color:rgb(149, 65, 33);">void</span></span></span><span> </span><span style="color:rgb(25, 70, 157);"><span><span style="color:rgb(25, 70, 157);">onMessage</span></span></span><span><span style="color:rgb(0, 0, 255);">(String message, Session session)</span> </span>{  
        <span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">if</span></span>(message.equals(<span style="color:rgb(33, 145, 97);"><span style="color:rgb(33, 145, 97);">"ping"</span></span>)){
        }<span style="color:rgb(149, 65, 33);"><span style="color:rgb(149, 65, 33);">else</span></span>{
        。。。。
        }
   }</pre> 
 <p style="margin:0px 0px 0.75em;font-size:16px;line-height:1.7em;text-indent:1em;">系统发现websocket每隔10分钟自动断开连接，搜了很多博客都说设置一下nginx的  keepalive_timeout  proxy_connect_timeout  proxy_send_timeout  proxy_read_timeout  这四个字段的时长即可，然而好像并不奏效。遂采取心跳包的方式每隔9分钟客户端自动发送ping消息给服务端，服务端不需要返回。即可解决问题。</p> 
</div>
        </div>
            <div style="font-size:16px;line-height:1.7em;margin-top:20px;"></div>
        	<div style="font-size:16px;line-height:1.7em;">

<ins style="display:block;height:280px;"><ins style="display:inline-table;border:none;height:280px;margin:0;padding:0;position:relative;visibility:visible;width:854px;background-color:transparent;"><ins style="display:block;border:none;height:280px;margin:0;padding:0;position:relative;visibility:visible;width:854px;background-color:transparent;"><div style="width:854px;height:280px;display:block;margin:0px auto 10px;left:0px;position:absolute;top:0px;border:0px;overflow:visible;"><div style="-evernote-clipper-iframe:timeout;"></div></div></ins></ins></ins>
</div>
    </div>
		<div>
	    	<div style="font-size:18px;font-weight:bolder;margin-left:24px;margin-bottom:10px;">相关文章</div>
	    	<ul style="padding:0px;margin:0px 0px 0.75em 25px;list-style-type:none;">
		                <li style="list-style-type:none;font-size:15px;line-height:28px;">
		                    1. <a href="http://www.voidcn.com/article/p-zshodvff-mm.html" target="_blank" title="websocket 心跳包重连" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> websocket 心跳包重连 </a>
		                </li>
		                <li style="list-style-type:none;font-size:15px;line-height:28px;">
		                    2. <a href="http://www.voidcn.com/article/p-hsmxsvsw-o.html" target="_blank" title="SecureCRT防止自动断开" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> SecureCRT防止自动断开 </a>
		                </li>
		                <li style="list-style-type:none;font-size:15px;line-height:28px;">
		                    3. <a href="http://www.voidcn.com/article/p-yekfjvtk-ne.html" target="_blank" title="WebSocket(伍) 断开连接" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> WebSocket(伍) 断开连接 </a>
		                </li>
		                <li style="list-style-type:none;font-size:15px;line-height:28px;">
		                    4. <a href="http://www.voidcn.com/article/p-uzyjppfy-pr.html" target="_blank" title="长连接和心跳包" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> 长连接和心跳包 </a>
		                </li>
		                <li style="list-style-type:none;font-size:15px;line-height:28px;">
		                    5. <a href="http://www.voidcn.com/article/p-klssgkmv-pg.html" target="_blank" title="长连接和心跳包 ." style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> 长连接和心跳包 . </a>
		                </li>
		                <li style="list-style-type:none;font-size:15px;line-height:28px;">
		                    6. <a href="http://www.voidcn.com/article/p-chxrbjwz-bgh.html" target="_blank" title="Socket 长连接 心跳包" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> Socket 长连接 心跳包 </a>
		                </li>
		                <li style="list-style-type:none;font-size:15px;line-height:28px;">
		                    7. <a href="http://www.voidcn.com/article/p-aezyyrft-bas.html" target="_blank" title="sql防止注入 连接" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> sql防止注入 连接 </a>
		                </li>
		                <li style="list-style-type:none;font-size:15px;line-height:28px;">
		                    8. <a href="http://www.voidcn.com/article/p-mnbhzvjr-ne.html" target="_blank" title="C# 防止连接跳出webbrowser界面" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> C# 防止连接跳出webbrowser界面 </a>
		                </li>
		                <li style="list-style-type:none;font-size:15px;line-height:28px;">
		                    9. <a href="http://www.voidcn.com/article/p-kwihnzfl-dp.html" target="_blank" title="wireshark抓包断开连接" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> wireshark抓包断开连接 </a>
		                </li>
		                <li style="list-style-type:none;font-size:15px;line-height:28px;">
		                    10. <a href="http://www.voidcn.com/article/p-vwabvzpq-hb.html" target="_blank" title="关于socket长连接的心跳包" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> 关于socket长连接的心跳包 </a>
		                </li>
	            <li style="list-style-type:none;font-size:15px;line-height:28px;"><a href="http://www.voidcn.com/relative/p-trguhbme-bnu.html" target="_blank" title="给websocket加入心跳包防止自动断开连接 的相关文章" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> 更多相关文章...</a></li>
	        </ul>

                <div style="margin-top:20px;"></div>
                <div>
                    <div>
<ins style="display:block;text-align:center;height:200px;"><ins style="display:inline-table;border:none;height:200px;margin:0;padding:0;position:relative;visibility:visible;width:864px;background-color:transparent;"><ins style="display:block;border:none;height:200px;margin:0px;padding:0px;position:relative;visibility:visible;width:864px;background-color:transparent;overflow:hidden;"><div style="left:0;position:absolute;top:0;border:0px;width:864px;height:200px;"><div style="-evernote-clipper-iframe:timeout;"></div></div></ins></ins></ins>
</div>
                </div>
            <div style="margin-top:20px;"></div>

	        <div style="font-size:18px;font-weight:bolder;margin-left:24px;margin-bottom:10px;">相关标签/搜索</div>
	        <ul style="padding:0px;margin:0px 0px 0.75em 25px;list-style-type:none;">
	        			<a target="_blank" href="http://www.voidcn.com/tag/%E5%BF%83%E8%B7%B3%E8%BF%9E%E6%8E%A5" title="心跳连接" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">心跳连接</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/tag/%E8%87%AA%E5%8A%A8%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5" title="自动断开连接" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">自动断开连接</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/tag/socket%E9%95%BF%E8%BF%9E%E6%8E%A5%E5%BF%83%E8%B7%B3%E5%8C%85" title="socket长连接心跳包" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">socket长连接心跳包</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/tag/secureCRT%E9%98%B2%E6%AD%A2%E6%96%AD%E5%BC%80" title="secureCRT防止断开" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">secureCRT防止断开</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/tag/%E6%96%AD%E5%BC%80%E8%BF%9E%E6%8E%A5" title="断开连接" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">断开连接</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/tag/%E8%BF%9E%E6%8E%A5%E6%96%AD%E5%BC%80" title="连接断开" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">连接断开</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/tag/%E8%BF%9E%E6%8E%A5%E8%87%AA%E5%8A%A8%E4%B8%AD%E6%96%AD" title="连接自动中断" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">连接自动中断</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/tag/%E8%87%AA%E5%8A%A8%E6%96%AD%E5%BC%80" title="自动断开" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">自动断开</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/tag/%E8%87%AA%E5%8A%A8%E8%BF%9E%E6%8E%A5" title="自动连接" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">自动连接</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/tag/NAO%E8%BF%9E%E6%8E%A5%E6%96%AD%E5%BC%80" title="NAO连接断开" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">NAO连接断开</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/cata/6061080" title="长连接 心跳包" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">长连接 心跳包</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/cata/1788251" title="心跳包" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">心跳包</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/cata/1573273" title="oracle 自动断开空闲连接" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">oracle 自动断开空闲连接</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/cata/1489133" title="防止sql注入" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">防止sql注入</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/cata/1644793" title="防止sql注入" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">防止sql注入</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/cata/953572" title="移动连接" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">移动连接</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/cata/663292" title="脉动连接" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">脉动连接</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/cata/3206039" title="断包" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">断包</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/cata/5695447" title="心跳" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">心跳</span></a>
	        			<a target="_blank" href="http://www.voidcn.com/cata/2403271" title="心跳" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"> <span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">心跳</span></a>
		        		<a target="_blank" href="http://www.voidcn.com/search/ntzgsg" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"><span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">websocket 心跳 断线</span></a>
		        		<a target="_blank" href="http://www.voidcn.com/search/nexzro" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"><span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">html websocket 心跳包</span></a>
		        		<a target="_blank" href="http://www.voidcn.com/search/phgfmc" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"><span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">java心跳连接</span></a>
		        		<a target="_blank" href="http://www.voidcn.com/search/rprxdb" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"><span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">websocket 防止别人链接</span></a>
		        		<a target="_blank" href="http://www.voidcn.com/search/wuknmk" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"><span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">websocket sendmessage 心跳</span></a>
		        		<a target="_blank" href="http://www.voidcn.com/search/ueqvzp" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"><span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">signalr手动断开连接</span></a>
		        		<a target="_blank" href="http://www.voidcn.com/search/dtajdh" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"><span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">socket长连接 短连接  心跳</span></a>
		        		<a target="_blank" href="http://www.voidcn.com/search/kioret" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"><span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">Netty 长连接 心跳</span></a>
		        		<a target="_blank" href="http://www.voidcn.com/search/spttcs" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"><span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">netty 长连接心跳</span></a>
		        		<a target="_blank" href="http://www.voidcn.com/search/rwvyrg" style="color:rgb(51, 51, 51);text-decoration:none;transition:all 0.25s ease 0s;outline:none 0px;"><span style="display:inline-block;padding:2px 4px;font-size:0.9em;line-height:16px;vertical-align:baseline;white-space:nowrap;background-color:rgb(242, 242, 242);color:rgb(120, 120, 120);text-decoration:none;">DotRas.RasDialer 断开连接</span></a>
	        </ul>
	    </div>
    
    <div style="margin-bottom:10px;">
        <div style="margin:0px auto;width:70px;height:70px;">
            <div style="width:70px;height:70px;outline:none 0px;border:1px solid rgb(222, 222, 222);border-radius:50%;background:url(http://static02.voidcn.com/voidcn/css/../images/social_share.png) 0px -80px no-repeat;vertical-align:middle;text-align:center;-webkit-tap-highlight-color:transparent;"></div>
        </div>
        <div style="clear:both;"></div>
        <div style="margin:20px 10px 20px 0px;line-height:32px;text-align:center;">
			<span style="float:left;margin-right:20px;">
				<a href="http://www.voidcn.com/article/p-trguhbme-bnu.html#" style="color:rgb(51, 51, 51);transition:all 0.25s ease 0s;outline:none 0px;font-family:FontAwesome;font-weight:400;font-style:normal;-webkit-font-smoothing:antialiased;display:inline;width:auto;height:auto;line-height:normal;vertical-align:baseline;background-image:none;background-position:0px 0px;background-repeat:repeat;margin-top:0px;text-decoration:inherit;margin-right:0px;"><span style="color:rgb(51, 51, 51);font-family:FontAwesome;font-weight:400;font-style:normal;line-height:normal;text-decoration:inherit;display:inline-block;speak:none;width:1em;margin-right:0.2em;text-align:center;font-variant:normal;text-transform:none;margin-left:0.2em;"></span>
					<span title="累计分享0次">0</span>
				</a>
			</span>
			<div style="float:right;">
				<span>
					<a href="http://www.voidcn.com/article/p-trguhbme-bnu.html#" title="分享到新浪微博" style="transition:all 0.25s ease 0s;outline:none 0px;font-family:FontAwesome;font-weight:400;font-style:normal;-webkit-font-smoothing:antialiased;vertical-align:baseline;background-image:none;background-position:0px 0px;background-repeat:repeat;text-decoration:none;display:inline-block;width:112px;height:32px;line-height:32px;text-align:center;border-style:solid;border-width:1px;font-size:13px;float:left;margin:0px;margin-bottom:10px;border-color:rgb(212, 65, 55);margin-right:10px;color:rgb(212, 65, 55);"><span style="color:rgb(212, 65, 55);font-family:FontAwesome;font-weight:400;font-style:normal;line-height:32px;text-align:center;font-size:13px;text-decoration:inherit;display:inline-block;speak:none;width:1em;margin-right:0.2em;font-variant:normal;text-transform:none;margin-left:0.2em;"></span>分享到微博</a>
					<a href="http://www.voidcn.com/article/p-trguhbme-bnu.html#" title="分享到微信" style="transition:all 0.25s ease 0s;outline:none 0px;font-family:FontAwesome;font-weight:400;font-style:normal;-webkit-font-smoothing:antialiased;vertical-align:baseline;background-image:none;background-position:0px 0px;background-repeat:repeat;text-decoration:none;display:inline-block;width:112px;height:32px;line-height:32px;text-align:center;border-style:solid;border-width:1px;font-size:13px;float:left;margin:0px;margin-bottom:10px;border-color:rgb(56, 173, 90);margin-right:10px;color:rgb(56, 173, 90);"><span style="color:rgb(56, 173, 90);font-family:FontAwesome;font-weight:400;font-style:normal;line-height:32px;text-align:center;font-size:13px;text-decoration:inherit;display:inline-block;speak:none;width:1em;margin-right:0.2em;font-variant:normal;text-transform:none;margin-left:0.2em;"></span>分享到微信</a>
					<a href="http://www.voidcn.com/article/p-trguhbme-bnu.html#" title="分享到QQ好友" style="transition:all 0.25s ease 0s;outline:none 0px;font-family:FontAwesome;font-weight:400;font-style:normal;-webkit-font-smoothing:antialiased;vertical-align:baseline;background-image:none;background-position:0px 0px;background-repeat:repeat;text-decoration:none;display:inline-block;width:112px;height:32px;line-height:32px;text-align:center;border-style:solid;border-width:1px;font-size:13px;float:left;margin:0px;margin-bottom:10px;border-color:rgb(57, 178, 226);color:rgb(57, 178, 226);"><span style="color:rgb(57, 178, 226);font-family:FontAwesome;font-weight:400;font-style:normal;line-height:32px;text-align:center;font-size:13px;text-decoration:inherit;display:inline-block;speak:none;width:1em;margin-right:0.2em;font-variant:normal;text-transform:none;margin-left:0.2em;"></span>分享到QQ</a>
				</span>
			</div>
		</div>
		<div style="clear:both;"></div>
    <div style="display:inline-block;margin:0px auto;text-align:center;"><span style="text-align:center;display:table;line-height:0;"></span>
        <span style="text-align:center;display:block;line-height:0;clear:both;visibility:hidden;height:0px;">.</span></div>
    </div>



	
	
    

</div></div></div></div></div></div>
</div>
</en-note>]]></content><created>20190904T132550Z</created><updated>20190904T132550Z</updated><note-attributes><source>web.clip7</source><source-url>http://www.voidcn.com/article/p-trguhbme-bnu.html</source-url><source-application>webclipper.evernote</source-application><reminder-order>0</reminder-order></note-attributes></note>
<note><title>构建netty遇到的问题</title><content><![CDATA[<!DOCTYPE en-note SYSTEM 'http://xml.evernote.com/pub/enml2.dtd'><en-note><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">1.开启通道是要在通道连接的时候active方法发送一下信息，才是连接成功<br/>
2.从通道writeandflush的对象必须是对应加解密静态对象（现在想想好像也不对，当时还是没有发送active导致的）毕竟心跳也可用</p>
</div><center style='display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden'>1.%E5%BC%80%E5%90%AF%E9%80%9A%E9%81%93%E6%98%AF%E8%A6%81%E5%9C%A8%E9%80%9A%E9%81%93%E8%BF%9E%E6%8E%A5%E7%9A%84%E6%97%B6%E5%80%99active%E6%96%B9%E6%B3%95%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%8B%E4%BF%A1%E6%81%AF%EF%BC%8C%E6%89%8D%E6%98%AF%E8%BF%9E%E6%8E%A5%E6%88%90%E5%8A%9F%0A2.%E4%BB%8E%E9%80%9A%E9%81%93writeandflush%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%BF%85%E9%A1%BB%E6%98%AF%E5%AF%B9%E5%BA%94%E5%8A%A0%E8%A7%A3%E5%AF%86%E9%9D%99%E6%80%81%E5%AF%B9%E8%B1%A1%EF%BC%88%E7%8E%B0%E5%9C%A8%E6%83%B3%E6%83%B3%E5%A5%BD%E5%83%8F%E4%B9%9F%E4%B8%8D%E5%AF%B9%EF%BC%8C%E5%BD%93%E6%97%B6%E8%BF%98%E6%98%AF%E6%B2%A1%E6%9C%89%E5%8F%91%E9%80%81active%E5%AF%BC%E8%87%B4%E7%9A%84%EF%BC%89%E6%AF%95%E7%AB%9F%E5%BF%83%E8%B7%B3%E4%B9%9F%E5%8F%AF%E7%94%A8%0A</center></en-note>]]></content><created>20190707T044048Z</created><updated>20190709T033654Z</updated><note-attributes><author>Oceanbai</author><source>desktop.mac</source><reminder-order>0</reminder-order><content-class>yinxiang.markdown</content-class></note-attributes></note>
<note><title>自定义长度帧解码器LengthFieldBasedFrameDecoder</title><content><![CDATA[<!DOCTYPE en-note SYSTEM 'http://xml.evernote.com/pub/enml2.dtd'><en-note><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">                             ByteBuf buf = Unpooled.buffer();

​                             String s = <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"呵呵,I am "</span> + j;

​                             byte[] bytes = s.getBytes(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"UTF-8"</span>);

​                             buf.writeInt(bytes.length);

​                             buf.writeBytes(bytes);

​                             channel.writeInbound(buf);
</code></pre>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">上面用到的自定义长度解码器LengthFieldBasedFrameDecoder构造器，涉及5个参数，都与长度域（数据包中的长度字段）相关，具体介绍如下：</h3>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">1. maxFrameLength - 发送的数据包最大长度；</h5>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">2. lengthFieldOffset - 长度域偏移量，指的是长度域位于整个数据包字节数组中的下标；</h5>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">3. lengthFieldLength - 长度域的自己的字节数长度。</h5>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">4. lengthAdjustment – 长度域的偏移量矫正。 如果长度域的值，除了包含有效数据域的长度外，还包含了其他域（如长度域自身）长度，那么，就需要进行矫正。矫正的值为：包长 - 长度域的值 – 长度域偏移 – 长度域长。</h5>
<h5 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 16px; color: #333;">5. initialBytesToStrip – 丢弃的起始字节数。丢弃处于有效数据前面的字节数量。比如前面有4个节点的长度域，则它的值为4。</h5>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">pipeline.addLast(new LengthFieldBasedFrameDecoder(1024 * 1024 * 5, 0, 4, -4, 4));
</code></pre>
<h4 style="line-height: 160%; box-sizing: content-box; font-size: 20px; color: #333;">第二个是0是因为该包的长度标识从头开始，用int存 4个字节，所以第三个是4，由于该长度是包括自己的，所以-4带上自己，最后一个参数意味着后面你拿到的数据长度==&gt; 你将得到的数据长度 = 长度域的长度 - 从包头到第几位的长度(总长度20 但是前面四位是标志这20的 那么 你如果只需要16位 你只需要解析的长度，那么就填4)</h4>
</div><center style='display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden'>%60%60%60bash%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ByteBuf%20buf%20%3D%20Unpooled.buffer()%3B%0A%0A%E2%80%8B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20String%20s%20%3D%20%22%E5%91%B5%E5%91%B5%2CI%20am%20%22%20%2B%20j%3B%0A%0A%E2%80%8B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20byte%5B%5D%20bytes%20%3D%20s.getBytes(%22UTF-8%22)%3B%0A%0A%E2%80%8B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20buf.writeInt(bytes.length)%3B%0A%0A%E2%80%8B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20buf.writeBytes(bytes)%3B%0A%0A%E2%80%8B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20channel.writeInbound(buf)%3B%0A%60%60%60%0A%23%23%23%20%E4%B8%8A%E9%9D%A2%E7%94%A8%E5%88%B0%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%BF%E5%BA%A6%E8%A7%A3%E7%A0%81%E5%99%A8LengthFieldBasedFrameDecoder%E6%9E%84%E9%80%A0%E5%99%A8%EF%BC%8C%E6%B6%89%E5%8F%8A5%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%8C%E9%83%BD%E4%B8%8E%E9%95%BF%E5%BA%A6%E5%9F%9F%EF%BC%88%E6%95%B0%E6%8D%AE%E5%8C%85%E4%B8%AD%E7%9A%84%E9%95%BF%E5%BA%A6%E5%AD%97%E6%AE%B5%EF%BC%89%E7%9B%B8%E5%85%B3%EF%BC%8C%E5%85%B7%E4%BD%93%E4%BB%8B%E7%BB%8D%E5%A6%82%E4%B8%8B%EF%BC%9A%0A%0A%23%23%23%23%23%201.%20maxFrameLength%20-%20%E5%8F%91%E9%80%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8C%85%E6%9C%80%E5%A4%A7%E9%95%BF%E5%BA%A6%EF%BC%9B%0A%0A%23%23%23%23%23%202.%20lengthFieldOffset%20-%20%E9%95%BF%E5%BA%A6%E5%9F%9F%E5%81%8F%E7%A7%BB%E9%87%8F%EF%BC%8C%E6%8C%87%E7%9A%84%E6%98%AF%E9%95%BF%E5%BA%A6%E5%9F%9F%E4%BD%8D%E4%BA%8E%E6%95%B4%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%8C%85%E5%AD%97%E8%8A%82%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E4%B8%8B%E6%A0%87%EF%BC%9B%0A%0A%23%23%23%23%23%203.%20lengthFieldLength%20-%20%E9%95%BF%E5%BA%A6%E5%9F%9F%E7%9A%84%E8%87%AA%E5%B7%B1%E7%9A%84%E5%AD%97%E8%8A%82%E6%95%B0%E9%95%BF%E5%BA%A6%E3%80%82%0A%0A%23%23%23%23%23%204.%20lengthAdjustment%20%E2%80%93%20%E9%95%BF%E5%BA%A6%E5%9F%9F%E7%9A%84%E5%81%8F%E7%A7%BB%E9%87%8F%E7%9F%AB%E6%AD%A3%E3%80%82%20%E5%A6%82%E6%9E%9C%E9%95%BF%E5%BA%A6%E5%9F%9F%E7%9A%84%E5%80%BC%EF%BC%8C%E9%99%A4%E4%BA%86%E5%8C%85%E5%90%AB%E6%9C%89%E6%95%88%E6%95%B0%E6%8D%AE%E5%9F%9F%E7%9A%84%E9%95%BF%E5%BA%A6%E5%A4%96%EF%BC%8C%E8%BF%98%E5%8C%85%E5%90%AB%E4%BA%86%E5%85%B6%E4%BB%96%E5%9F%9F%EF%BC%88%E5%A6%82%E9%95%BF%E5%BA%A6%E5%9F%9F%E8%87%AA%E8%BA%AB%EF%BC%89%E9%95%BF%E5%BA%A6%EF%BC%8C%E9%82%A3%E4%B9%88%EF%BC%8C%E5%B0%B1%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E7%9F%AB%E6%AD%A3%E3%80%82%E7%9F%AB%E6%AD%A3%E7%9A%84%E5%80%BC%E4%B8%BA%EF%BC%9A%E5%8C%85%E9%95%BF%20-%20%E9%95%BF%E5%BA%A6%E5%9F%9F%E7%9A%84%E5%80%BC%20%E2%80%93%20%E9%95%BF%E5%BA%A6%E5%9F%9F%E5%81%8F%E7%A7%BB%20%E2%80%93%20%E9%95%BF%E5%BA%A6%E5%9F%9F%E9%95%BF%E3%80%82%0A%0A%23%23%23%23%23%205.%20initialBytesToStrip%20%E2%80%93%20%E4%B8%A2%E5%BC%83%E7%9A%84%E8%B5%B7%E5%A7%8B%E5%AD%97%E8%8A%82%E6%95%B0%E3%80%82%E4%B8%A2%E5%BC%83%E5%A4%84%E4%BA%8E%E6%9C%89%E6%95%88%E6%95%B0%E6%8D%AE%E5%89%8D%E9%9D%A2%E7%9A%84%E5%AD%97%E8%8A%82%E6%95%B0%E9%87%8F%E3%80%82%E6%AF%94%E5%A6%82%E5%89%8D%E9%9D%A2%E6%9C%894%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E9%95%BF%E5%BA%A6%E5%9F%9F%EF%BC%8C%E5%88%99%E5%AE%83%E7%9A%84%E5%80%BC%E4%B8%BA4%E3%80%82%0A%0A%60%60%60bash%0Apipeline.addLast(new%20LengthFieldBasedFrameDecoder(1024%20*%201024%20*%205%2C%200%2C%204%2C%20-4%2C%204))%3B%0A%60%60%60%0A%0A%23%23%23%23%20%E7%AC%AC%E4%BA%8C%E4%B8%AA%E6%98%AF0%E6%98%AF%E5%9B%A0%E4%B8%BA%E8%AF%A5%E5%8C%85%E7%9A%84%E9%95%BF%E5%BA%A6%E6%A0%87%E8%AF%86%E4%BB%8E%E5%A4%B4%E5%BC%80%E5%A7%8B%EF%BC%8C%E7%94%A8int%E5%AD%98%204%E4%B8%AA%E5%AD%97%E8%8A%82%EF%BC%8C%E6%89%80%E4%BB%A5%E7%AC%AC%E4%B8%89%E4%B8%AA%E6%98%AF4%EF%BC%8C%E7%94%B1%E4%BA%8E%E8%AF%A5%E9%95%BF%E5%BA%A6%E6%98%AF%E5%8C%85%E6%8B%AC%E8%87%AA%E5%B7%B1%E7%9A%84%EF%BC%8C%E6%89%80%E4%BB%A5-4%E5%B8%A6%E4%B8%8A%E8%87%AA%E5%B7%B1%EF%BC%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E6%84%8F%E5%91%B3%E7%9D%80%E5%90%8E%E9%9D%A2%E4%BD%A0%E6%8B%BF%E5%88%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E9%95%BF%E5%BA%A6%3D%3D%3E%20%E4%BD%A0%E5%B0%86%E5%BE%97%E5%88%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E9%95%BF%E5%BA%A6%20%3D%20%E9%95%BF%E5%BA%A6%E5%9F%9F%E7%9A%84%E9%95%BF%E5%BA%A6%20-%20%E4%BB%8E%E5%8C%85%E5%A4%B4%E5%88%B0%E7%AC%AC%E5%87%A0%E4%BD%8D%E7%9A%84%E9%95%BF%E5%BA%A6(%E6%80%BB%E9%95%BF%E5%BA%A620%20%E4%BD%86%E6%98%AF%E5%89%8D%E9%9D%A2%E5%9B%9B%E4%BD%8D%E6%98%AF%E6%A0%87%E5%BF%97%E8%BF%9920%E7%9A%84%20%E9%82%A3%E4%B9%88%20%E4%BD%A0%E5%A6%82%E6%9E%9C%E5%8F%AA%E9%9C%80%E8%A6%8116%E4%BD%8D%20%E4%BD%A0%E5%8F%AA%E9%9C%80%E8%A6%81%E8%A7%A3%E6%9E%90%E7%9A%84%E9%95%BF%E5%BA%A6%EF%BC%8C%E9%82%A3%E4%B9%88%E5%B0%B1%E5%A1%AB4)</center></en-note>]]></content><created>20190703T124136Z</created><updated>20190703T125548Z</updated><note-attributes><author>Oceanbai</author><source>desktop.mac</source><reminder-order>0</reminder-order><content-class>yinxiang.markdown</content-class></note-attributes></note>
</en-export>
